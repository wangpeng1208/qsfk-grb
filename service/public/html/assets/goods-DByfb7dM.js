import{i as se,d as Se,c8 as qe,e as l,s as Ve,l as H,r as D,v as Me,U as z,o as i,p as c,g as e,F as C,q as L,b as g,t as r,a as f,w as ee,n as u,c as Ie,cb as Te,c9 as je,M as h,cc as He,a2 as De,ap as Pe,ca as Ue,m as Be,ae as te,u as Ne,cd as Ae}from"./index-Bl4AiOyE.js";import{g as Oe}from"./order-Dtn26sDb.js";/* empty css                  */import{D as ze}from"./index-LkEl_aIh.js";import{I as Qe}from"./index-CLnbRl90.js";import{I as $e}from"./index-CCnSBKQl.js";import{S as Fe}from"./index-BXPKF7iO.js";import{D as Re}from"./index-BKyk21AZ.js";import"./useLengthLimit-zZTqNE_r.js";import"./log-ZJhmUOBa.js";import"./useReadonly-DZtTxOfz.js";import"./const-BLdXWxIl.js";import"./useVModel-HmF1Gebj.js";import"./useResizeObserver-BUPtuDKJ.js";import"./dep-d524834c-s9Vwwbzr.js";import"./browse-CCDZKZZU.js";import"./close-circle-filled-xz65pYuL.js";import"./useCommonClassName-B8MbwXBA.js";import"./number-jGqlEXl8.js";function Ee(){return se.post({url:"/home/pay/payChannel"})}function Ze(S){return se.post({url:"/home/pay/payOrder",params:S})}function Ge(S){const d=window.location.origin,q=new URL("/home/pay/pay",d);return q.search=new URLSearchParams({trade_no:S.trade_no}).toString(),q.toString()}const Ye={class:"home",style:{"background-image":"linear-gradient(90deg, #f5f5fa, #f5f5fa 50%, #fff 0)"}},Je={class:"flex flex-col min-h-screen text-base font-sans"},Ke={class:"header fixed top-0 lg:z-40 z-20 bg-white w-full font-sans-alt"},We={class:"flex max-w-1440 mx-auto"},Xe={class:"header-logo flex-shrink-0 w-376 lg:block hidden"},et={class:"block h-54 max-w-200 -mt-8",href:"/"},tt=["src"],st=Pe('<span class="flex items-center h-24 w-24 mr-8 p-2 flex-grow-0 flex-shrink-0"><svg class="h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 14"><path d="M19,8H1A1,1,0,0,1,1,6H19a1,1,0,0,1,0,2Z"></path><path d="M19,2H1A1,1,0,0,1,1,0H19a1,1,0,0,1,0,2Z"></path><path d="M19,14H1a1,1,0,0,1,0-2H19a1,1,0,0,1,0,2Z"></path></svg></span>',1),ot=[st],nt=e("span",{class:"header-item hover:text-xenon-600 border-b-2 flex items-center h-full cursor-pointer transition-fast-out"}," 首页 ",-1),at=[nt],lt=e("span",{class:"header-item hover:text-xenon-600 border-b-2 flex items-center h-full cursor-pointer transition-fast-out"}," 查询订单 ",-1),it=[lt],ct=e("span",{class:"header-item hover:text-xenon-600 border-b-2 flex items-center h-full cursor-pointer transition-fast-out"}," 联系我们 ",-1),rt=[ct],dt={class:"flex-1 mx-auto w-full max-w-1440 bg-white pt-72"},ut={class:"flex h-full",style:{height:"100%",position:"relative"}},_t={class:"fixed top-0 flex-shrink-0 bg-x-gradient-grey-200-grey-400-80 leading-tight lg:w-376 lg:flex lg:flex-col z-30 h-screen w-full hidden","data-target":"app.sidebar"},mt=e("div",{class:"lg:block h-72 flex-grow-0 flex-shrink-0 hidden"},null,-1),ht={class:"flex-grow w-inherit overflow-y-auto h-full"},ft={class:"h-full"},pt={class:"px-40 pt-48 pb-24"},vt=e("button",{class:"block mb-32 text-xs font-semibold leading-none uppercase tracking-wide text-grey-700-opacity-60 focus:outline-none"},[e("span",null," 商品栏目 ")],-1),gt=["onClick"],xt={class:"flex items-center"},yt={class:"px-40"},bt={class:"items-center -mx-16 py-16 border-grey-400-opacity-60 border-solid border-t"},wt={class:"block mx-16 py-8 text-sm text-grey-700 hover:text-grey-800 transition-fast-out"},kt=["innerHTML"],Ct=e("span",{class:"flex items-center h-16 w-16 mr-16 flex-grow-0 flex-shrink-0"},[e("svg",{class:"block h-full",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14"},[e("path",{d:"M8.41,7l5.3-5.29A1,1,0,1,0,12.29.29L7,5.59,1.71.29A1,1,0,0,0,.29,1.71L5.59,7,.29,12.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0L7,8.41l5.29,5.3a1,1,0,0,0,1.42,0,1,1,0,0,0,0-1.42Z"})])],-1),Lt=e("span",{class:"block flex-grow-0 flex-shrink-0 mt-2 font-sans-alt text-base leading-none"}," 关闭 ",-1),St=[Ct,Lt],qt={class:"w-full lg:ml-376 overflow-x-hidden goods-con"},Vt={class:"p-24 md:px-56 md:pt-48 md:pb-24"},Mt={class:"mb-4 flex justify-between items-start"},It={class:"text-xs leading-tight"},Tt={class:"font-sans-alt font-semibold tracking-wide"},jt={class:"grid grid-rows gap-4 sm:grid-cols-2"},Ht={class:"bg-white p-4"},Dt=["src"],Pt={class:"bg-white p-4"},Ut=e("div",{class:"flex items-center justify-between"},null,-1),Bt={class:"flex items center p-4"},Nt=e("label",{for:"contact",class:"mr-5"},"商品价格",-1),At={class:"text-xl font-bold text-red-400"},Ot={class:"flex items-center justify-between center p-4"},zt={class:"flex items-center justify-between"},Qt=e("label",{for:"contact",class:"mr-5"},"剩余库存",-1),$t={class:"flex items-center justify-between"},Ft=e("label",{for:"contact",class:"mr-5"},"已售",-1),Rt={class:"flex items center p-4"},Et=e("label",{for:"contact",class:"mr-5 w-15"},"联系方式",-1),Zt={class:"mr-5 w-40"},Gt={class:"flex items center p-4"},Yt=e("label",{for:"num",class:"mr-5 w-15"},"购买数量",-1),Jt={key:0,class:"flex items center p-4"},Kt=e("label",{for:"num",class:"mr-5 w-15"},"用优惠券",-1),Wt={key:1,class:"flex items center p-4"},Xt=e("label",{for:"num",class:"mr-5 w-15"},"优惠券号",-1),es={key:2,class:"flex items center p-4"},ts=e("label",{for:"num",class:"mr-5 w-15"},"取卡密码",-1),ss=e("div",{class:"flex items center p-4"},[e("label",{for:"num",class:"mr-5 w-15"},"选择支付方式")],-1),os={class:"flex items center p-4"},ns={class:"variations__list",id:"pay-type"},as=["onClick"],ls={style:{float:"left"}},is=["src"],cs={class:"flex items center p-4"},rs={key:0,class:"s"},ds={class:"flex items center p-4"},us={key:0},_s={class:"bg-white"},ms={class:"p-4"},hs=e("h2",{class:"text-xl font-bold text-gray-800"},"商品详情",-1),fs={class:"text-gray-700 mt-4"},ps=["innerHTML"],vs={key:0,class:"p-4"},gs=e("h2",{class:"text-l font-bold text-gray-800"},"满减优惠",-1),xs={class:"flex items-center justify-between"},ys={for:"contact",class:"mr-2"},bs={class:"text-sm font-bold text-red-400"},ws={key:1,class:"p-4"},ks=e("h2",{class:"text-sl font-bold text-gray-800"},"活动赠送",-1),Cs={class:"flex items-center justify-between"},Ls={for:"contact",class:"mr-2"},Ss={class:"text-sm font-bold text-red-400"},qs={key:2,class:"p-4"},Vs=e("h2",{class:"text-l font-bold text-gray-800"},"附加赠送",-1),Ms={class:"flex items-center justify-between"},Is={for:"contact",class:"mr-2"},Ts={class:"text-sm font-bold text-red-400"},js=["innerHTML"],eo=Se({__name:"goods",setup(S){const d=qe(),q=Ue(),V=Be(),Q=l();Ve(()=>{Q.value=q.params.id});const P=l(d.getCurrentCate),oe=H(()=>d.config.site_logo),ne=H(()=>d.config.site_info_copyright),o=D({}),M=D({}),$=l(d.config.goods_default_img);(async()=>{const t=await Te({id:Q.value});if(t.code===1){for(const s in t.data)o[s]=t.data[s],n.goods_id=t.data.id;t.data.slider_image!=null&&t.data.slider_image.length>0&&($.value=t.data.slider_image[0]);for(const s in t.data.cate)M[s]=t.data.cate[s],d.setCurrentCate(M.id),P.value=M.id;T()}})();const U=l([]),F=l([]),ae=async()=>{const t=await je();t.code===1&&(F.value=t.data.list,U.value=t.data.list,U.value.unshift({id:0,name:"全部"}))},le=t=>{d.setCurrentCate(t),V.push({name:"index",params:{id:t}})},ie=()=>{V.push({name:"index"})},ce=()=>{V.push({name:"order"})},re=()=>{V.push({name:"about"})};Me(()=>{ae()});const R=l(!1),de=()=>{R.value=!0;const t=document.querySelector('[data-target="app.sidebar"]');t.classList.toggle("flex"),t.classList.toggle("flex-col"),t.classList.remove("hidden")},ue=()=>{R.value=!1;const t=document.querySelector('[data-target="app.sidebar"]');t.classList.toggle("hidden"),t.classList.remove("flex"),t.classList.remove("flex-col")},_e=t=>{const s=F.value.find(v=>v.id===t);return s?s.name:""},I=l([]),x=D({channel_id:0});(async()=>{const t=await Ee();t.code?(I.value=t.data,x.channel_id=I.value.length?I.value[0].channel_id:0,n.pid=x.channel_id):console.error("支付方式加载失败")})();const y=l("无限制"),b=l("[必填]推荐填写QQ号或手机号!"),E=()=>{o.contact_limit==="any"?y.value="任意字符串":o.contact_limit==="mobile"?(y.value="只能输入手机号",b.value="[必填]请填写您的手机号!"):o.contact_limit==="email"?(y.value="只能输入邮箱",b.value="[必填]请填写您的邮箱!"):o.contact_limit==="qq"?(y.value="只能输入QQ号",b.value="[必填]请填写您的QQ号!"):y.value="[必填]请输入联系方式"};E();const me=l([]);z(()=>me.value,t=>{t.includes(1)?b.value="[必填]请填写您的手机号!":E(),t.includes(2)?n.isemail=1:n.isemail=0,T()});const w=l(!1);z(()=>w.value,t=>{if(t){n.is_coupon=1;return}n.is_coupon=0});const he=t=>{x.channel_id=t,n.pid=t},fe=t=>{t&&(T(),t>o.cards_stock_count&&h.error("库存不足"))},n=D({goods_id:0,contact:"",coupon_code:"",pwdforsearch:"",isemail:0,email:"",pid:x.channel_id,is_coupon:0,quantity:o.limit_quantity?o.limit_quantity:1,agreement:!1});z(()=>n.coupon_code,t=>{t&&T()});const pe=t=>t.toFixed(2),ve=(t,s,v)=>(s.sort((m,O)=>m.num-O.num).forEach(m=>{v>=m.num&&(t=m.price)}),t),B=l(0),_=l(0),k=l(0),Z=l(0),p=l(0),N=l(""),T=async()=>{if(Z.value=o.price,k.value=o.price,o.wholesale_discount_list!=null&&(k.value=ve(o.price,o.wholesale_discount_list,n.quantity)),B.value=Z.value*n.quantity,k.value>0?_.value=k.value*n.quantity:_.value=B.value,w.value===!0&&n.coupon_code!==""){const t={coupon_code:n.coupon_code,goods_id:o.id,cate_id:M.id,quantity:n.quantity,total_price:k.value*n.quantity},s=await He(t);s.code===1?(s.data.type===1?p.value=s.data.amount:s.data.type===2&&(p.value=_.value*s.data.amount/100),N.value=`优惠券可用,优惠${s.data.amount}${s.data.type===1?"元":"%"}`,p.value>_.value&&(p.value=_.value,N.value=`优惠券可用,优惠${s.data.amount}${s.data.type===1?"元":"%"}，但大于订单金额，本单享受全额优惠【0元购买】`)):(N.value=s.msg,p.value=0)}_.value=parseFloat(pe(Number(_.value)-Number(p.value)))},ge=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),G=l(null),A=l(!1),Y=l(!1),J=l(""),xe=H(()=>d.config.show_purchase_agreement),j=l(!1),ye=()=>{n.agreement=!0,j.value=!1,K()},be=H(()=>d.config.shop_buy_protocol),K=async()=>{if(n.contact===""){h.error("请填写联系方式");return}if(n.quantity===0){h.error("购买数量不能为0");return}if(n.pid===0){h.error("请选择支付方式");return}if(n.is_coupon===1&&n.coupon_code===""){h.error("请填写优惠券");return}if(xe&&!n.agreement){j.value=!0;return}const t=await Ze(n);if(t.code===1){h.success(t.msg);const s=await Ge({trade_no:t.data.trade_no});G.value=setInterval(async()=>{(await W(t.data.trade_no)).code===1&&(h.success("支付成功! "),Y.value=!0,J.value=t.data.trade_no,A.value=!1,clearInterval(G.value),we.value=!0)},3e3),await W(t.data.trade_no),setTimeout(()=>{A.value=!0,ge()?location.href=s:window.open(s)},1e3)}else h.error(t.msg)},we=l(!1),W=async t=>await Oe({trade_no:t});return(t,s)=>{const v=De,X=ze,m=Qe,O=$e,ke=Fe,Ce=Re;return i(),c("div",Ye,[e("div",Je,[e("header",Ke,[e("div",We,[e("div",Xe,[e("a",et,[e("img",{src:oe.value,class:"h-full w-full fill-current"},null,8,tt)])]),e("nav",{class:"header-nav z-30 flex flex-grow items-center bg-white px-16 whitespace-no-wrap lg:h-auto h-72 min-w-0"},[e("div",{class:"flex lg:hidden"},[e("div",{class:"h-24 w-24 mr-24 ml-8 md:ml-40"},[e("button",{class:"flex items-center mr-32 text-grey-1000 hover:text-grey-1000 fill-current focus:outline-none focus:shadow-outline",onClick:de},ot)])]),e("ul",{class:"h-full mx-24 uppercase leading-tight text-sm font-semibold tracking-wide flex"},[e("li",{class:"flex items-center h-full mx-16",onClick:ie},at),e("li",{class:"flex items-center h-full mx-16",onClick:ce},it),e("li",{class:"flex items-center h-full mx-16",onClick:re},rt)])])])]),e("div",dt,[e("div",ut,[e("aside",_t,[mt,e("div",ht,[e("div",ft,[e("div",pt,[vt,e("ul",null,[(i(!0),c(C,null,L(U.value,a=>(i(),c("li",{class:"mt-24 cursor-pointer",onClick:Le=>le(a.id)},[e("a",{class:te(["flex items-center hover:text-xenon-600 transition-fast-out",{"text-xenon-600":P.value===a.id}])},[e("span",xt,r(a.name),1)],2)],8,gt))),256))])])])]),e("div",yt,[e("div",bt,[e("div",wt,[e("p",{innerHTML:ne.value},null,8,kt),g(" 骑士发卡（个人版）qqss.net ")])])]),e("button",{class:"flex lg:hidden absolute items-center top-0 right-0 mt-48 mr-40 text-grey-700-opacity-90 hover:text-grey-700 fill-current transition-fast-out focus:outline-none focus:shadow-outline",onClick:ue},St)]),e("div",qt,[e("div",Vt,[e("div",Mt,[e("div",It,[e("div",Tt," 首页 / "+r(_e(P.value))+" / "+r(o.name),1)])]),f(v,{text:"支付中...",loading:A.value,size:"small",fullscreen:""},null,8,["loading"]),e("div",jt,[e("div",Ht,[e("img",{src:$.value,alt:"商品图片",class:"w-fullobject-cover object-center"},null,8,Dt)]),e("div",Pt,[Ut,e("div",Bt,[Nt,e("div",null,[e("span",At,"￥"+r(o.price),1)])]),e("div",Ot,[e("div",zt,[Qt,e("div",null,r(o.cards_stock_count),1)]),e("div",$t,[Ft,e("div",null,r(o.cards_sold_count),1)])]),f(X,null,{default:ee(()=>[g(" 开始下单 ")]),_:1}),e("div",Rt,[Et,e("div",Zt,[f(m,{modelValue:n.contact,"onUpdate:modelValue":s[0]||(s[0]=a=>n.contact=a),style:{width:"260px"},name:"contact",placeholder:b.value,clearable:""},null,8,["modelValue","placeholder"])])]),e("div",Gt,[Yt,f(O,{modelValue:n.quantity,"onUpdate:modelValue":s[1]||(s[1]=a=>n.quantity=a),step:1,max:o.cards_stock_count,min:o.limit_quantity,"auto-width":"",clearable:"",onChange:fe,style:{width:"260px"}},null,8,["modelValue","max","min"])]),o.coupon_type?(i(),c("div",Jt,[Kt,e("div",null,[f(ke,{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=a=>w.value=a)},null,8,["modelValue"])])])):u("",!0),w.value&&o.coupon_type?(i(),c("div",Wt,[Xt,e("div",null,[f(m,{modelValue:n.coupon_code,"onUpdate:modelValue":s[3]||(s[3]=a=>n.coupon_code=a),style:{width:"260px"},name:"coupon_code",placeholder:"请填写你的优惠券"},null,8,["modelValue"])])])):u("",!0),!o.buy_need_login&&o.take_card_type!=0?(i(),c("div",es,[ts,e("div",null,[o.take_card_type!=0?(i(),Ie(m,{key:0,style:{width:"260px"},modelValue:n.pwdforsearch,"onUpdate:modelValue":s[4]||(s[4]=a=>n.pwdforsearch=a),placeholder:"请输入取卡密码（6-20位）"},null,8,["modelValue"])):u("",!0)])])):u("",!0),ss,e("div",os,[e("div",ns,[(i(!0),c(C,null,L(I.value,a=>(i(),c("span",{class:te(["pay-type btn",x.channel_id==a.channel_id?"active":""]),onClick:Le=>he(a.channel_id)},[e("span",ls,[e("img",{style:{width:"21px"},src:Ne(Ae)(a.ico)},null,8,is)]),e("span",null,r(a.show_name),1)],10,as))),256))])]),e("div",cs,[e("button",{class:"bg-blue-500 text-white px-40 py-2 ml-2",onClick:K},[g(" (￥"+r(_.value)+" ",1),o.coupon_type&&n.coupon_code?(i(),c("span",rs,"原价："+r(B.value),1)):u("",!0),g(") 立即下单 ")])]),e("div",ds,[Y.value?(i(),c("div",us,"支付成功！！ 订单号为："+r(J.value),1)):u("",!0)])])]),e("div",_s,[e("div",ms,[hs,e("div",fs,[e("p",{innerHTML:o.content},null,8,ps)])]),o.wholesale_discount_list!=null&&o.wholesale_discount_list.length>0?(i(),c("div",vs,[gs,(i(!0),c(C,null,L(o.wholesale_discount_list,a=>(i(),c("div",xs,[e("label",ys,"买满"+r(a.num)+"件",1),e("span",bs,"单价"+r(a.price)+"元",1)]))),256))])):u("",!0),o.event_give!=null&&o.event_give.length>0?(i(),c("div",ws,[ks,(i(!0),c(C,null,L(o.event_give,a=>(i(),c("div",Cs,[e("label",Ls,"每买"+r(a.num)+"件",1),e("span",Ss,"赠送"+r(a.give_num)+"件",1)]))),256))])):u("",!0),o.addtion_give!=null&&o.addtion_give.length>0?(i(),c("div",qs,[Vs,(i(!0),c(C,null,L(o.addtion_give,a=>(i(),c("div",Ms,[e("label",Is,"买满"+r(a.bug_num)+"件",1),e("span",Ts,[g("赠送`"),e("b",null,r(a.goods_name),1),g("`商品"+r(a.give_num)+"件",1)])]))),256))])):u("",!0)])])])])])]),f(Ce,{visible:j.value,"onUpdate:visible":s[5]||(s[5]=a=>j.value=a),"close-on-overlay-click":!1,header:"购卡协议",mode:"modal",draggable:"","confirm-btn":"同意协议，并继续下单","on-confirm":ye},{body:ee(()=>[e("div",{innerHTML:be.value},null,8,js)]),_:1},8,["visible"])])}}});export{eo as default};
