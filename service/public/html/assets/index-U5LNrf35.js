import{d as K,m as Q,r as W,k as X,e as v,v as Y,l as Z,o as p,c as y,w as t,g as b,a as o,u as r,b as n,t as z,n as S,p as D,x,D as P,M as c,B as w,a2 as ee}from"./index-CpJFga7x.js";import{l as te}from"./category-C8UM67HR.js";import{b as ae,c as oe,l as se,f as ie}from"./good-DRjBmnT5.js";import ne from"./index-C8jaOAgS.js";import{p as le}from"./global-DaymibWd.js";import{f as re}from"./date-dYGoxvTx.js";import{c as ce}from"./constant-4vGkG4Wa.js";import de from"./search-DXIN59Oa.js";import{S as me}from"./index-DePaE_yS.js";import{I as ue}from"./index--0mKpQel.js";import{S as pe}from"./index-fiMfjcvP.js";import{I as _e}from"./index-DUYa5w0Y.js";import{T as fe}from"./index-BRf9TXQS.js";import{L as he}from"./index-aNeCThFX.js";import{S as ge}from"./index-Cg1ZmWJU.js";import{B as ve}from"./index-DJO90WwP.js";import{C as ye}from"./index-DJSz0Bsf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B4p2E3Fl.js";import"./useLengthLimit-OjWIxDWr.js";import"./log-ZJhmUOBa.js";import"./dep-02de0cb4-9NqRuOAE.js";import"./dep-4cc4ef27-DQG4x64P.js";import"./dep-96cefb8b-hs2i3_dz.js";import"./index-Dk9r_Pa_.js";import"./useVModel-CzdLJ13E.js";import"./observe-CfjnoQGd.js";import"./common-CF_MvV9u.js";import"./useReadonly-Bx8TEnun.js";import"./dep-d524834c-s9Vwwbzr.js";import"./slot-DL8tHB3s.js";import"./index-DnrQMYJZ.js";import"./index-BcRf9bEE.js";import"./useResizeObserver-ONY0TviC.js";import"./useDefaultValue-BJZ6w0Fl.js";import"./close-circle-filled-1kZBSjap.js";import"./const-BD0RkfTU.js";import"./browse-CF75H87A.js";import"./index-byKPUDsR.js";import"./dep-eedf0c29-v-LgRmZs.js";import"./index-BqrdyjaG.js";import"./index-Dhx8Vlw0.js";import"./useCommonClassName-DGbYtLoH.js";import"./number--X5gY8kS.js";import"./chevron-left-BX4tOZyG.js";import"./chevron-right-DSRNsGLo.js";import"./useVirtualScrollNew-XoyDLD8W.js";import"./dep-af55fe23-3nGiADk5.js";import"./dep-86139c71-Dc2HrHYK.js";import"./index-D7oq8DY2.js";import"./helper-DkMMPY9i.js";import"./dep-40320ba3-B1Ayvxeb.js";import"./dep-1858b432-D8vbiQ_j.js";import"./form-model-ChnUeRwN.js";const Ce={class:"category-header c-flex"},ke={class:"l"},be={key:0},ze={key:1},Se={name:"Goods"},Vt=K({...Se,setup($e){const _=Q(),f=W({cate_id:null,name:""}),{query:B}=_.currentRoute.value;B.cate_id&&(f.cate_id=+B.cate_id);const L=X(),$=v([]),m=v({defaultPageSize:20,total:0,defaultCurrent:1}),R=v(!1),V=v(!1),h=x(async()=>{V.value=!0;const s={page:m.value.defaultCurrent,limit:m.value.defaultPageSize,...f};try{const{data:a}=await se(s);$.value=a.list,m.value={...m.value,total:a.total}}catch{}finally{V.value=!1}}),U=x(h),T=v([]),I=async()=>{const{data:s}=await te();T.value=s.list};Y(()=>{h(),I()});const N=async s=>{const a=P({header:"提醒？",body:"确定清空该商品所有未售虚拟卡吗？",confirmBtn:"确认",onConfirm:({e:l})=>{a.hide();const{id:u}=s;ae({id:u}).then(i=>{i.code===1?(c.success("删除成功"),h()):c.error(`删除失败：${i.msg}`)}).catch(i=>{c.error("删除失败")})},onClose:({e:l,trigger:u})=>{a.hide()}})},M=(s,a)=>{m.value.defaultCurrent=s.current,m.value.defaultPageSize=s.pageSize,h()},A=async s=>{const a=P({header:"提醒",body:`是否确认删除(${s.name})？`,confirmBtn:"确认",onConfirm:({e:l})=>{a.hide();const{id:u}=s;oe({id:u}).then(i=>{i.code===1?(h(),c.success("删除成功")):c.error(`删除失败：${i.msg}`)}).catch(i=>{c.error("删除失败")})},onClose:({e:l,trigger:u})=>{a.hide()}})},G=x(async(s,a)=>{try{const l=await ie({id:s,val:a});l.code===1?c.success(l.msg):c.error(l.msg)}catch{c.error("修改失败")}}),q=s=>{const{id:a}=s;_.push(`/admin/goods/edit?id=${a}`)},E=Z(()=>({offsetTop:L.isUseTabsRouter?48:0,container:`.${le}-layout`}));return(s,a)=>{const l=me,u=ue,C=w,i=pe,O=_e,k=fe,g=he,j=ge,F=ve,H=ee,J=ye;return p(),y(J,{title:"商品列表",class:"basic-container",bordered:!1},{default:t(()=>[b("div",Ce,[b("div",ke,[o(i,null,{default:t(()=>[o(l,{modelValue:f.cate_id,"onUpdate:modelValue":a[0]||(a[0]=e=>f.cate_id=e),clear:r(h),empty:"没有分类",placeholder:"全部分类",type:"search",clearable:"",options:T.value},null,8,["modelValue","clear","options"]),o(u,{modelValue:f.name,"onUpdate:modelValue":a[1]||(a[1]=e=>f.name=e),placeholder:"请输入商品名",clearable:""},{"suffix-icon":t(()=>[o(r(de))]),_:1},8,["modelValue"]),o(C,{theme:"default",variant:"outline",onClick:r(U)},{default:t(()=>[n("查询")]),_:1},8,["onClick"])]),_:1})])]),o(F,{class:"basic-table",data:$.value,columns:r(ce),"row-key":"id","vertical-align":"middle",hover:$.value.length>0,pagination:m.value,loading:V.value,"header-affixed-top":E.value,"table-layout":"auto","max-height":"100%",onPageChange:M},{topContent:t(()=>[o(C,{theme:"primary",class:"mb15",onClick:a[2]||(a[2]=e=>r(_).push("/admin/goods/add"))},{icon:t(()=>[o(O,{name:"add"})]),default:t(()=>[n(" 添加商品 ")]),_:1})]),name:t(({row:e})=>[o(i,{direction:"vertical",size:"small",class:"tag-demo light"},{default:t(()=>[b("span",null,[n(z(e.name)+" ",1),e.wholesale_discount==1?(p(),y(k,{key:0,title:"支持批发优惠",theme:"success",variant:"light",size:"small",shape:"round"},{default:t(()=>[n("惠")]),_:1})):S("",!0),e.coupon_type==1?(p(),y(k,{key:1,title:"支持优惠券",theme:"primary",variant:"light",size:"small",shape:"round"},{default:t(()=>[n("券")]),_:1})):S("",!0),e.take_card_type!=0?(p(),y(k,{key:2,title:"提卡必填或选填取卡密码",theme:"warning",variant:"light",size:"small",shape:"round"},{default:t(()=>[n("取")]),_:1})):S("",!0),e.visit_type==1?(p(),y(k,{key:3,title:"商品购买页面需要访问密码",theme:"danger",variant:"light",size:"small",shape:"round"},{default:t(()=>[n("密")]),_:1})):S("",!0)])]),_:2},1024)]),cards_stock_counts:t(({row:e})=>[o(i,{size:"small"},{default:t(()=>[e.cards_stock_counts===0?(p(),D("div",be,"缺货")):(p(),D("div",ze,[o(g,{size:"small",theme:"primary",underline:"",onClick:d=>r(_).push(`/admin/goods/card?goods_id=${e.id}&status=1`)},{default:t(()=>[n(z(e.cards_stock_counts)+" 张 ",1)]),_:2},1032,["onClick"]),o(i,{size:"small"},{default:t(()=>[o(g,{size:"small",theme:"danger",onClick:d=>N(e)},{default:t(()=>[n("清空")]),_:2},1032,["onClick"])]),_:2},1024)]))]),_:2},1024)]),cards_sold_counts:t(({row:e})=>[o(g,{size:"small",theme:"primary",underline:"",onClick:d=>r(_).push(`/admin/goods/card?goods_id=${e.id}&status=2`)},{default:t(()=>[n(z(e.cards_sold_counts)+"张",1)]),_:2},1032,["onClick"])]),status:t(({row:e})=>[o(j,{modelValue:e.status,"onUpdate:modelValue":d=>e.status=d,"custom-value":[1,0],onClick:d=>r(G)(e.id,e.status)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),create_at:t(({row:e})=>[b("span",null,z(r(re)(e.create_at)),1)]),operation:t(({row:e})=>[o(i,null,{default:t(()=>[o(g,{theme:"primary",hover:"color",onClick:d=>r(_).push(`/admin/goods/card/add?goods_id=${e.id}`),size:"small"},{default:t(()=>[n("补货")]),_:2},1032,["onClick"]),o(g,{theme:"primary",hover:"color",onClick:d=>q(e),size:"small"},{default:t(()=>[n("编辑")]),_:2},1032,["onClick"]),o(g,{theme:"danger",hover:"color",onClick:d=>A(e),size:"small"},{default:t(()=>[n("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),empty:t(()=>[o(ne,{title:"",tip:"暂无相关数据",type:"list"})]),_:1},8,["data","columns","hover","pagination","loading","header-affixed-top"]),o(H,{loading:R.value,size:"small",fullscreen:""},null,8,["loading"])]),_:1})}}});export{Vt as default};
