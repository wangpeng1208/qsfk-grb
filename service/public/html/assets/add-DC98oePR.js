import{d as D,m as L,e as u,U as k,v as j,j as O,o as c,p as P,a as o,w as r,u as s,b as y,c as V,n as b,g as $,x as E,B as G,M as h,V as z}from"./index-Dys89YLq.js";import{d as A}from"./date-DY_Aq1Lj.js";import{l as H}from"./category-DQvQx6ik.js";import{s as J}from"./good-BMX4p-GN.js";import{c as K,i as Q,a as W}from"./constant-U8yziX81.js";import{I as X}from"./index-B8o3bOvu.js";import{F as Y,a as Z}from"./index-BYoZ1jRX.js";import{S as ee}from"./index-Ci-WgI1t.js";import{C as te}from"./index-BXsxSE5D.js";import{I as oe}from"./index-xCa1PnD5.js";import{R as ae}from"./index-Q2T2ZnL7.js";import{S as le}from"./index-DwGXmo2C.js";import{a as re}from"./index-ZphBY69t.js";import{D as me}from"./index-r19_zikN.js";import{T as ne}from"./index-CQi5G9rp.js";import{C as ie}from"./index-D8Ix0oeU.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dep-86139c71-BioGcMu7.js";import"./form-model-CIY_RhMw.js";import"./dep-4cc4ef27--AW_KZeX.js";import"./dep-40320ba3-B1Ayvxeb.js";import"./index-k_yBcVp0.js";import"./useReadonly-GuO_-cT8.js";import"./useVModel-ChUVkX5D.js";import"./log-ZJhmUOBa.js";import"./useResizeObserver-D_uTF440.js";import"./dep-d524834c-s9Vwwbzr.js";import"./close-circle-filled-6NKz9kYY.js";import"./dep-02de0cb4-_xWusXWA.js";import"./dep-96cefb8b-CiB99TH1.js";import"./index-BTVA41u8.js";import"./observe-CfjnoQGd.js";import"./common-CF_MvV9u.js";import"./slot-DKAjzcwC.js";import"./index-BA1slVbh.js";import"./index-CjM8dnKg.js";import"./useDefaultValue-pk1y0m3m.js";import"./index-BcNem8rV.js";import"./chevron-right-Bz__VYX8.js";import"./tree-store-ClV-hxBZ.js";import"./dep-eedf0c29-ErImML_u.js";import"./dep-6f8c2110-CYZdOZC2.js";import"./useCommonClassName-BZA0SnO7.js";import"./number-B3LVzGws.js";import"./helper-DDcUnKCP.js";import"./dep-af55fe23-hzblXEZ8.js";import"./index-Dka09D2p.js";import"./chevron-left-Ca8qIpvl.js";const se={class:"anim-wrapper"},pe={class:"form-submit-confirm anim-wrapper"},de={name:"GoodsCouponAdd"},ce=D({...de,setup(_e){const _=L(),e=u({cate_id:0,goods_id:null,type:1,amount:"",quantity:"",min_banlance:"",expire_at:"",remark:"",import_coupon:0,use_times:1,receive:0}),f=u("满减优惠券，设置多少元则抵扣总价的多少元"),v={amount:[{required:!0,message:"请填写折扣面额",type:"error"}],quantity:[{required:!0,message:"请填写数量",type:"error"}],expire_at:[{required:!0,message:"请选择到期时间",type:"error"}]},m=u(1);k(()=>m.value,l=>{l!=1&&(e.value.cate_id=0),l===1&&(e.value.cate_id=0,e.value.goods_id=null),l===2&&(g(l),e.value.cate_id="",e.value.goods_id=null,v.cate_id=[{required:!0,message:"请选择商品分类",type:"error"}]),l===3&&(g(l),e.value.cate_id=0,v.goods_id=[{required:!0,message:"请选择商品",type:"error"}])}),k(()=>e.value.type,l=>{l===1?f.value=`
      满减优惠券，设置多少元则抵扣总价的多少元
      `:f.value=`
      折扣卡券，设置比例10%则是9折20%为8折，以此类推
      `});const p=u([]),g=async l=>{if(l===2){const{data:t}=await H();p.value=t.list}if(l===3){const{data:t}=await J();p.value=t}},x=u(null);j(()=>{const{query:l}=_.currentRoute.value;l.cate_id&&(e.value.cate_id=l.cate_id)});const U=E(async()=>{const l=await x.value.validate();if(typeof l!="object"&&l){const t={...e.value,coupon_type:m.value},i=await W(t);i.code===1?(h.success(i.msg),e.value.import_coupon&&z(i.data.url),setTimeout(()=>{_.push("/admin/goods/coupon")},500)):h.error(`新增失败：${i.msg}`)}});return(l,t)=>{const i=X,w=G,q=O("wp-check-tag"),n=Y,C=ee,S=te,d=oe,T=ae,B=le,I=re,R=me,F=ne,M=Z,N=ie;return c(),P("div",se,[o(N,{title:"添加优惠券",class:"basic-container"},{actions:r(()=>[o(w,{variant:"text",theme:"default",onClick:t[0]||(t[0]=a=>s(_).push("/admin/goods/coupon"))},{icon:r(()=>[o(i,{name:"rollback"})]),default:r(()=>[y(" 返回 ")]),_:1})]),default:r(()=>[o(M,{ref_key:"form",ref:x,class:"base-form",data:e.value,rules:v,"label-align":"left","label-width":120,onSubmit:s(U)},{default:r(()=>[o(n,{label:"优惠券类型",name:"couponTypeValue"},{default:r(()=>[o(q,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),items:s(K)},null,8,["modelValue","items"])]),_:1}),m.value!=1?(c(),V(n,{key:0,label:m.value===2?"选择分类":"选择商品",name:m.value===2?"cate_id":"goods_id",tips:m.value===2?"【必选】请选择商品分类":"【必选】请选择商品"},{default:r(()=>[m.value===2?(c(),V(C,{key:0,modelValue:e.value.cate_id,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.cate_id=a),placeholder:"请选择商品分类",type:"search",clearable:"",options:p.value,style:{width:"415px"}},null,8,["modelValue","options"])):b("",!0),m.value===3?(c(),V(S,{key:1,modelValue:e.value.goods_id,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.goods_id=a),placeholder:"请选择商品",type:"search",clearable:"",options:p.value,style:{width:"415px"},trigger:"hover",valueMode:"onlyLeaf"},null,8,["modelValue","options"])):b("",!0)]),_:1},8,["label","name","tips"])):b("",!0),o(n,{label:"折扣面额",name:"amount",tips:f.value},{default:r(()=>[o(B,null,{default:r(()=>[o(d,{modelValue:e.value.amount,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.amount=a),theme:"normal",placeholder:"请填写数字",style:{width:"415px"}},null,8,["modelValue"]),o(T,{modelValue:e.value.type,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.type=a),options:s(Q)},null,8,["modelValue","options"])]),_:1})]),_:1},8,["tips"]),o(n,{label:"生成数量",name:"quantity",tips:"最多一次生成200张"},{default:r(()=>[o(d,{modelValue:e.value.quantity,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.quantity=a),placeholder:"填写优惠券生成数量",max:200,min:1,theme:"normal"},null,8,["modelValue"])]),_:1}),o(n,{label:"到期时间",name:"expire_at",tips:"过期优惠券系统将自动清理"},{default:r(()=>[o(I,{modelValue:e.value.expire_at,"onUpdate:modelValue":t[7]||(t[7]=a=>e.value.expire_at=a),"allow-input":"",clearable:"",placeholder:"请选择到期时间","disable-date":{before:s(A)().add(0,"day").endOf("day").format()},presetsPlacement:"right"},null,8,["modelValue","disable-date"])]),_:1}),o(R,{dashed:"",style:{width:"575px"}},{default:r(()=>[y("高级设置")]),_:1}),o(n,{label:"使用门槛",name:"min_banlance",tips:"此功能为满减优惠卷，超过此金额的订单才可使用的优惠券。不填则无限制"},{default:r(()=>[o(d,{modelValue:e.value.min_banlance,"onUpdate:modelValue":t[8]||(t[8]=a=>e.value.min_banlance=a),placeholder:"请填写数字",theme:"normal"},null,8,["modelValue"])]),_:1}),o(n,{label:"可使用次数",name:"use_times",tips:"优惠券可被使用次数"},{default:r(()=>[o(d,{modelValue:e.value.use_times,"onUpdate:modelValue":t[9]||(t[9]=a=>e.value.use_times=a),placeholder:"请填写使用次数",theme:"normal",suffix:"次"},null,8,["modelValue"])]),_:1}),o(n,{label:"备注信息",name:"remark"},{default:r(()=>[o(F,{modelValue:e.value.remark,"onUpdate:modelValue":t[10]||(t[10]=a=>e.value.remark=a),placeholder:"可填写优惠券备注信息",style:{width:"415"}},null,8,["modelValue"])]),_:1}),o(n,null,{default:r(()=>[$("div",pe,[o(w,{theme:"primary",block:"",size:"large",type:"submit",style:{margin:"2px"}},{default:r(()=>[y(" 提交 ")]),_:1})])]),_:1})]),_:1},8,["data","onSubmit"])]),_:1})])}}}),ut=ue(ce,[["__scopeId","data-v-70de5377"]]);export{ut as default};
